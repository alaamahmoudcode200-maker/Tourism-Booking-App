function init(t){var e="https://api.apitiny.net/";var i=t?.getAttribute("site-id")||t?.getAttribute("data-site-id")||"%siteId";let n="true"===(t?.getAttribute("test-mode")||t?.getAttribute("data-test-mode"));if(!i)return console.warn("Site Id is missing for proper work of TinyAdz module");let d="$ta2",r={GET_AS:e+"api/gas",GET_SITE_CONFIG:e+"api/gsc"};"ontouchstart"in window||0<navigator.maxTouchPoints||window.matchMedia("(pointer: coarse)").matches;let m="ta-ad-container";t=document.body.clientHeight-window.innerHeight<100;let g=t?0:Math.max(10,.01*window.innerHeight),h={INLINED:"INLINED",FULL_SCREEN:"FULL_SCREEN",CORNER:"CORNER"};class a{constructor({allowedRenderModes:t=[]}={}){this.allowedRenderModes=t,this.lastShownTimestamps=this._loadTimestamps()}_loadTimestamps(){try{var t=localStorage.getItem("tinyadz_lastShownTimestamps");return t?JSON.parse(t):{FULL_SCREEN:null}}catch(t){return{FULL_SCREEN:null}}}_saveTimestamps(){localStorage.setItem("tinyadz_lastShownTimestamps",JSON.stringify(this.lastShownTimestamps))}trackAdShown(t){var e=Date.now();t===h.FULL_SCREEN&&(this.lastShownTimestamps.FULL_SCREEN=e,this._saveTimestamps())}checkIfAllowed(t){var e=Date.now();if(!this.allowedRenderModes.includes(t))return!1;switch(t){case h.INLINED:return!0;case h.FULL_SCREEN:var i=this.lastShownTimestamps[h.FULL_SCREEN];return!i||9e5<=e-i;case h.CORNER:return this.allowedRenderModes.includes(h.FULL_SCREEN)?(i=this.lastShownTimestamps.FULL_SCREEN)&&1e4<=e-i:!0;default:return!1}}}class o{constructor({selectors:t=[`[${m}]`],rootMargin:e="200px",threshold:i=.1,onNewContainerAppeared:s=null,placements:n,maxSlotsPerPage:r}={}){this.placements=n||[],this.maxSlotsPerPage=r||5,this.selectors=t,this.adSlotCounter=0,this.onNewContainerAppeared=s||this.defaultHandler;n=document.querySelector("#TA_AD_CONTAINER");n&&(n.setAttribute(m,"true"),n.removeAttribute("id")),this.placements.length&&this.addSlots(this.placements,this.maxSlotsPerPage),this.adObserver=new IntersectionObserver(this.handleAdIntersection.bind(this),{rootMargin:e,threshold:i}),this.mutationObserver=new MutationObserver(this.handleMutations.bind(this)),this.observeExistingContainers(),this.observeDOMMutations(),this.triggerVisibleOnLoad()}addSlots(t,c){let u=.8*window.innerHeight;let g=0;t.forEach(({selector:e,placement:h,cssClasses:l})=>{g;try{let t=[];(t=e.includes(":contains")?function(t){var e=/:contains\\((['"])(.*?)\\1\\)/,i=t.match(e);if(!i)return Array.from(document.querySelectorAll(t));let s=i[2];return i=t.replace(e,""),Array.from(document.querySelectorAll(i)).filter(t=>t.textContent.includes(s))}(e):document.querySelectorAll(e)).forEach(t=>{if(!(g>=c))if(t&&t.parentElement){var{width:i,top:s}=t.parentElement.getBoundingClientRect(),{paddingLeft:n,paddingRight:r}=window.getComputedStyle(t.parentElement),i=i-parseFloat(n)-parseFloat(r);if(s+window.scrollY<u)return console.warn("To close to the top placement for ",h),!1;if(i<250)return console.warn("To narrow container for",h),!1;if(t.nextSibling?.attributes&&void 0!==t.nextSibling.attributes[m])return console.warn("Attempt to another add at the same container",h),!1;var a,o=t.getBoundingClientRect();for(a of document.querySelectorAll(`[${m}]`)){var d=a.getBoundingClientRect();if(Math.abs(d.top-o.top)<350)return console.warn("Too close to another ad",h),!1}let e=document.createElement("div");e.setAttribute(m,!0),l?.length&&l.forEach(t=>e.classList.add(t.replace(/\./,""))),t.parentElement.insertBefore(e,t.nextSibling),g++}else console.warn("Ad target not found for:",h)})}catch(t){}})}getNewContainerId(){return"ta-container-"+this.adSlotCounter++}removeSlot(t){t&&t.remove&&t.remove()}triggerVisibleOnLoad(){this.selectors.map(t=>Array.from(document.querySelectorAll(t))).flat().filter(t=>this.isElementVisible(t)).forEach(t=>{this.onSlotVisible(t)})}handleAdIntersection(t){t.forEach(t=>{t.isIntersecting&&(t=t.target,this.onSlotVisible(t))})}onSlotVisible(t){t.dataset.filled||(t.dataset.filled=!0,t.id||(t.id=this.getNewContainerId()),this.onNewContainerAppeared({containerRef:t}))}handleMutations(t){for(var e of t)e.addedNodes.forEach(t=>{1===t.nodeType&&(t.hasAttribute?.("tinyadz-ad-container")?this.observeAdContainer(t):this.observeAdContainers(t))})}observeAdContainer(t){this.adObserver.observe(t)}observeAdContainers(t=document){this.selectors.map(t=>Array.from(document.querySelectorAll(t))).flat().forEach(t=>this.observeAdContainer(t))}observeExistingContainers(){this.observeAdContainers()}observeDOMMutations(){var t=this._debounceMutations(this.handleMutations.bind(this),100);this.mutationObserver=new MutationObserver(t),this.mutationObserver.observe(document.body,{childList:!0,subtree:!0})}_debounceMutations(e,i){let s=null,n=[];return function(t){n.push(...t),clearTimeout(s),s=setTimeout(()=>{e(n),n=[]},i)}}defaultHandler(t){console.warn("No onNewContainerAppeared handler defined for:",t)}isElementVisible(t){t=t.getBoundingClientRect();return t.top<window.innerHeight&&0<t.bottom&&t.left<window.innerWidth&&0<t.right}disconnect(){this.adObserver.disconnect(),this.mutationObserver.disconnect()}}let s={_avg:t=>t.length?t.reduce((t,e)=>t+e,0)/t.length:0,_variance:t=>{if(t.length<2)return 0;let i=s._avg(t);return t.reduce((t,e)=>t+(e-i)**2,0)/t.length}};class l{constructor(t={}){this.cfg={minStepPx:5,maxStepPx:500,maxReasonableSpeed:1e5,turnDeg:12,turnHystDeg:6,straightDeg:4,straightHystDeg:2,minStraightDist:100,maxPointerPoints:60,...t},this._onMoveBound=null,this.pointerPath=[],this.stats={totalDistance:0,speeds:[],turns:0,straightIntervals:0},this._lastAngle=null,this._curvatureAbove=!1,this._straightState=!1,this._straightAccumDist=0}bind(){this._onMoveBound=this._onPointerMove.bind(this),window.addEventListener("pointermove",this._onMoveBound,{passive:!0})}unbind(){this._onMoveBound&&window.removeEventListener("pointermove",this._onMoveBound)}reset(){this.pointerPath.length=0,this.stats.totalDistance=0,this.stats.speeds.length=0,this.stats.turns=0,this.stats.straightIntervals=0,this._lastAngle=null,this._curvatureAbove=!1,this._straightState=!1,this._straightAccumDist=0}configure(t){Object.assign(this.cfg,t||{})}getSnapshot(){var t=this.stats.totalDistance,e=this.stats.turns;return{bendsPerK:0<t?e/(t/1e3):0,straightIntervals:this.stats.straightIntervals,totalDistance:t,turns:e,speedAvg:s._avg(this.stats.speeds),speedVariance:s._variance(this.stats.speeds)}}_onPointerMove(t){var e,i,s,n=Date.now(),t={x:t.clientX,y:t.clientY,t:n};0===this.pointerPath.length?(this._pushPoint(t),this._lastAngle=null,this._curvatureAbove=!1,this._straightState=!1,this._straightAccumDist=0):(n=this.pointerPath[this.pointerPath.length-1],e=t.x-n.x,s=t.y-n.y,i=Math.hypot(e,s),n=Math.max(1,t.t-n.t)/1e3,this._shouldAcceptStep(i)&&(this._updateDistanceAndSpeed(i,i/n),n=Math.atan2(s,e),s=this._angleDeltaAbs(n,this._lastAngle),this._updateStraightState(s,i),this._updateTurnState(s),this._lastAngle=n),this._pushPoint(t))}_shouldAcceptStep(t){var{minStepPx:e,maxStepPx:i}=this.cfg;return e<=t&&t<=i}_updateDistanceAndSpeed(t,e){var i=this.cfg["maxReasonableSpeed"];this.stats.totalDistance+=t,Number.isFinite(e)&&e<i&&((t=this.stats.speeds).push(e),100<t.length)&&t.shift()}_angleDeltaAbs(t,e){if(null==e)return 0;let i=t-e;for(;i>Math.PI;)i-=2*Math.PI;for(;i<-Math.PI;)i+=2*Math.PI;return Math.abs(i)}_updateStraightState(t,e){var{straightDeg:i,straightHystDeg:s,minStraightDist:n}=this.cfg,r=i*Math.PI/180,i=(i+s)*Math.PI/180;!this._straightState&&t<=r&&(this._straightState=!0,this._straightAccumDist=0),this._straightState&&(this._straightAccumDist+=e,i<=t)&&(this._straightAccumDist>=n&&this.stats.straightIntervals++,this._straightState=!1,this._straightAccumDist=0)}_updateTurnState(t){var{turnDeg:e,turnHystDeg:i}=this.cfg,s=e*Math.PI/180,e=Math.max(0,(e-i)*Math.PI/180);!this._curvatureAbove&&s<=t?(this.stats.turns++,this._curvatureAbove=!0,this._straightState&&(this._straightAccumDist>=this.cfg.minStraightDist&&this.stats.straightIntervals++,this._straightState=!1,this._straightAccumDist=0)):this._curvatureAbove&&t<=e&&(this._curvatureAbove=!1)}_pushPoint(t){this.pointerPath.push(t),this.pointerPath.length>this.cfg.maxPointerPoints&&this.pointerPath.shift()}}class c{_pointerMoveTracker=null;constructor({idleTimeout:t=3e4,updateIntervalMs:e=1e3,maxPointerPoints:i=30,curvatureAngleDeg:s=15,onUpdate:n=()=>{}}={}){this.idleTimeout=t,this.updateIntervalMs=e,this.onUpdate=n,this._listeners=[],this._updateTimer=null,this._idleTimer=null,this._running=!1,this._pointerMoveTracker=new l({maxPointerPoints:i,curvatureAngleDeg:s}),this.resetState()}resetState(){var t=Date.now();this.scrollDepth=0,this.scrollSpeeds=[],this._lastScrollY=window.scrollY||0,this._lastScrollTs=t,this.clicks=0,this.activityBuffer=[],this.isIdle=!1,this.lastActiveTime=t,this.isTabVisible=!document.hidden,this.orientationChanges=0,this.startTime=t,this._pointerMoveTracker.reset()}startTracking(){this._running||(this._running=!0,this._pointerMoveTracker.bind(),this._add(window,"pointerdown",this._onClick,{passive:!0}),this._add(window,"scroll",this._onScroll,{passive:!0}),this._add(document,"visibilitychange",this._onVisibility,{passive:!0}),this._add(window,"orientationchange",this._onOrientation,{passive:!0}),this._idleTimer=setInterval(()=>this._detectIdle(),1e3),this._updateTimer=setInterval(()=>{try{this.onUpdate(this.getSnapshot())}catch(t){console.warn("Error in onUpdate callback",t)}},this.updateIntervalMs))}stopTracking(){this._running&&(this._running=!1,this._listeners.forEach(({target:t,event:e,handler:i,opts:s})=>{t.removeEventListener(e,i,s)}),this._listeners=[],clearInterval(this._idleTimer),clearInterval(this._updateTimer),this._idleTimer=null,this._updateTimer=null)}destroy(){this.stopTracking()}getSnapshot(){var t=Date.now(),e=this._pointerMoveTracker.getSnapshot();return{ts:t,idle:this.isIdle,timeActiveMs:t-this.startTime,scrollStats:{scrollDepth:this.scrollDepth,speedAvg:s._avg(this.scrollSpeeds),speedVariance:s._variance(this.scrollSpeeds)},pointerStats:e,clicks:this.clicks,activityBuffer:this.activityBuffer.slice(),isTabVisible:this.isTabVisible,orientationChanges:this.orientationChanges}}_add(t,e,i,s){i=i.bind(this);t.addEventListener(e,i,s),this._listeners.push({target:t,event:e,handler:i,opts:s})}_detectIdle(){var t=Date.now(),e=this.isIdle;this.isIdle=t-this.lastActiveTime>this.idleTimeout,this.isIdle!==e&&"function"==typeof this.onUpdate&&this.onUpdate(this.getSnapshot())}_registerActivity(){this.lastActiveTime=Date.now(),this.isIdle=!1}_onClick(t){this._registerActivity(),this.clicks++;var e={tagName:t.target?.tagName,id:t.target?.id||null};this.activityBuffer.push({x:t.clientX,y:t.clientY,action:"CLICK",t:Date.now(),elem:e}),10<this.activityBuffer.length&&this.activityBuffer.shift()}_onScroll(){this._registerActivity();var t=Date.now(),e=window.scrollY||0,i=Math.abs(e-this._lastScrollY),s=Math.max(1,t-this._lastScrollTs)/1e3;this.scrollSpeeds.push(i/s),this.scrollDepth=Math.max(this.scrollDepth,e),this._lastScrollY=e,this._lastScrollTs=t}_onVisibility(){this.isTabVisible=!document.hidden,this._registerActivity()}_onOrientation(){this.orientationChanges++,this._registerActivity()}}if(void 0===window.$tam){let t=location.href;function u(){location.href!==t&&(t=location.href,void 0!==window.$tam)&&setTimeout(()=>{window.$tam.requestNextAd()},100)}let e=new class{constructor(t){this.siteId=t,this.config$=this.setupSite(),this.adsRendering={},this.availableAds=[],this.engagement$=null,this.adsFetchingPromises$={},this.recentAdFetchingResponses={},this.adSlotCounter=0,this.allowedRenderModes=[],this.engagementManager=new c({updateIntervalMs:100,onUpdate:t=>{window[d]&&window[d].captureVisitorEngagement(t)}}),this.engagementManager.startTracking()}waitForUserEngagement(c=3e3,u=0){return new Promise(t=>{let e=!1,i=!1,s=0,n=!1,r=()=>{window.removeEventListener("scroll",d,{passive:!0}),document.removeEventListener("mousemove",l,!0),document.removeEventListener("touchmove",h,{passive:!0})},a=(t,e)=>{t=document.elementFromPoint(t,e);return!!t&&!!t.closest&&!!t.closest("iframe.tinyadz-iframe")},o=()=>{e&&i&&s>=u&&!n&&(r(),t())},d=()=>{(window.scrollY??window.pageYOffset??document.documentElement.scrollTop??0)>=g&&(i=!0,o())},h=t=>{t=t.changedTouches&&t.changedTouches[0];t&&(n=a(t.clientX,t.clientY)),(s+=1)>=u&&o()},l=t=>{n=a(t.clientX,t.clientY),(s+=1)>=u&&o()};setTimeout(()=>{e=!0,o()},c),window.addEventListener("scroll",d,{passive:!0}),document.addEventListener("mousemove",l,!0),document.addEventListener("touchmove",h,{passive:!0}),d()})}async requestNextAd({renderModes:t}={}){return this.showAds({renderModes:t})}async onNewContainerDetected({containerRef:t}){return this.showAds({containerRef:t})}async showAds({containerRef:e=null,renderModes:i=null}={}){this.engagement$||(this.engagement$=this.waitForUserEngagement()),await this.engagement$,i||await this.fetchAds();var s=await this.config$;if(s.enabled){let t=[...this.allowedRenderModes];0<i?.length?t=i:e&&(t=t.filter(t=>t===h.INLINED));for(var n of t=t.filter(t=>this.adRenderModesController.checkIfAllowed(t)))try{var r=s.theme||"light",a=""+n+(e?"-"+e.id:"");if(this.adsRendering[a]||!1)return;this.fetchAndRenderAds({renderingKey:a,renderMode:n,theme:r,containerRef:e})}catch(t){console.error(t)}}else console.warn("TinyAdz script exit as WebSite Ad Module is disabled")}async fetchAndRenderAds({renderingKey:t,renderMode:e,theme:i,containerRef:s}){try{var n;if(!this.adsRendering[t])return this.adsRendering[t]=!0,n=await this.getNextAd(e),await this.renderAd(n,e,i,s)}catch(t){console.error("TinyAdz init failed",t)}finally{this.adsRendering[t]=!1}}loadScripts(){var t=[this.loadManagerScript()];return Promise.all(t)}loadScript(s,n){return new Promise((t,e)=>{if(document.getElementById(n))return t();var i=document.createElement("script");i.id=n,i.src=s,i.async=!0,i.onload=()=>{t()},i.onerror=t=>e(new Error("Failed to load ta script"+n+". "+t?.message)),document.head.appendChild(i)})}loadManagerScript(){return this.loadScript("https://cdn.apitiny.net/scripts/v2.0/manager.js?hostType=ads","TINYADZ-WIDGET-MANAGER-SCRIPT")}async setupSite(){try{await this.loadBotDetectionFrame();var t=new URLSearchParams({siteId:this.siteId,pageUrl:location.href,refererUrl:document.referrer,width:window.innerWidth,height:window.innerHeight,testMode:n,version:2}).toString(),s=(await(await fetch(r.GET_SITE_CONFIG+"?"+t)).json())["config"];if(await this.loadScripts(),this.allowedRenderModes=s.widgets.map(({renderMode:t})=>t),this.adRenderModesController=new a({allowedRenderModes:this.allowedRenderModes}),s.widgets.find(({renderMode:t})=>t===h.INLINED)){s.placementConfig||(s.placementConfig={placements:[],maxSlotsPerPage:3});let{placements:e,maxSlotsPerPage:i}=s["placementConfig"];await new Promise(t=>{setTimeout(()=>{this.inlineAdsContainerManager=new o({onNewContainerAppeared:this.onNewContainerDetected.bind(this),placements:e,maxSlotsPerPage:i}),t()},1e3)})}return s}catch(t){return console.error("Failed to fetch TinyAdz config",t),{enabled:!1}}}loadBotDetectionFrame(){return new Promise(e=>{try{var t="https://cdn.apitiny.net/bot-detection?siteId="+this.siteId,i=document.createElement("iframe");i.src=t,i.width="0",i.height="0",i.style.display="none",i.style.border="0",i.referrerPolicy="no-referrer-when-downgrade",i.allow="autoplay; fullscreen",document.body.appendChild(i),e()}catch(t){console.err("Validation Iframe installation failed"),e()}})}async fetchAds(i){if(this.adsFetchingPromises$[i]&&await this.adsFetchingPromises$[i],this.availableAds=this.availableAds.filter(t=>t.expiresAt>Date.now()),!(!i&&0<this.availableAds.length||i&&this.availableAds.some(t=>t.renderMode===i))){var t=this.recentAdFetchingResponses[i||"all"];if(t){var{ts:t,ads:e}=t,t=Date.now()-t<3e5,e=0===e.length;if(t&&e)return[]}this.adsFetchingPromises$[i]=new Promise(async t=>{var e=new URLSearchParams({siteId:this.siteId,renderMode:i||"",pageUrl:location.href,width:window.innerWidth,height:window.innerHeight,testMode:n,version:2}).toString(),e=(await(await fetch(r.GET_AS+"?"+e)).json())["ads"];this.availableAds.push(...e),this.recentAdFetchingResponses[i||"all"]={ads:e,ts:Date.now()},t(e)}),await this.adsFetchingPromises$[i]}return this.availableAds}async getNextAd(i){try{this.adsFetchingPromises$[i]&&await this.adsFetchingPromises$[i];let e=this.availableAds.find(t=>t.renderMode===i&&t.expiresAt>Date.now());return e||await this.fetchAds(i),(e=this.availableAds.find(t=>t.renderMode===i))&&(this.availableAds=this.availableAds.filter(t=>t!==e)),e}catch(t){return console.error("Failed to fetch available ads",t),null}}async waitForContainer(e,i=3,s=1e3){for(let t=0;t<i;t++){var n=document.querySelector(e);if(n)return n;t<i-1&&await new Promise(t=>setTimeout(t,s))}return null}async renderAd(t,e=h.FULL_SCREEN,i="light",s=null){if(t)if(window[d])try{var{widgetId:n,snapshotId:r}=t;switch(this.adRenderModesController.trackAdShown(e),e){case h.INLINED:var a=s;return a?void window[d].renderInlined(n,{snapshotId:r,theme:i,renderMode:e,container:a}):void console.warn("Ad container is not provided for ad placement");case h.CORNER:var o=await this.waitForContainer("body",10,150);return o?void window[d].renderInlined(n,{snapshotId:r,theme:i,renderMode:e,container:o}):void console.warn("Ad container not found after retries");case h.FULL_SCREEN:window[d].showPopup(n,null,{snapshotId:r,theme:i,renderMode:e})}}catch(t){console.error("Failed to fetch available ads",t)}else console.warn("Ads are not visible as manager script is not loaded");else e===h.INLINED&&s&&this.inlineAdsContainerManager.removeSlot(s)}renderAdsOnUserInteraction(){return this.waitForUserEngagement(15e3,0).then(()=>{this.requestNextAd({renderModes:[h.CORNER,h.FULL_SCREEN]}),this.renderAdsOnUserInteraction()})}}(i);window.tam=window.$tam={requestNextAd:e.requestNextAd.bind(e)},e.config$.then(async t=>{await Promise.race(t.widgets.map(({renderMode:t})=>e.fetchAds(t)));{var i=u;let t=history.pushState,e=(history.pushState=function(){t.apply(this,arguments),i()},history.replaceState);history.replaceState=function(){e.apply(this,arguments),i()},window.addEventListener("popstate",i)}await e.requestNextAd(),setTimeout(()=>{e.allowedRenderModes.find(t=>t===h.CORNER)&&e.renderAdsOnUserInteraction()},1e4)})}}let currentScript=document.currentScript||(()=>{var e=document.getElementsByTagName("script");for(let t=e.length-1;0<=t;t--)if(e[t].getAttribute("src")?.includes("main.js")&&Boolean(e[t].getAttribute("site-id")))return e[t];return null})();"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>init(currentScript)):init(currentScript);